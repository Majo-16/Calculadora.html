<!-- index.html con login, chatbot IA y graficador -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>MathMajo - Calculadora con IA</title>
  <script src="https://cdn.jsdelivr.net/npm/mathjs@11.11.0/lib/browser/math.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "FAKE-API-KEY",
      authDomain: "calculadora-majo.firebaseapp.com",
      projectId: "calculadora-majo",
      appId: "1:123456789:web:demo"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    onAuthStateChanged(auth, user => {
      if (user) {
        document.getElementById('login-area').style.display = 'none';
        document.getElementById('calc-area').style.display = 'block';
      } else {
        document.getElementById('login-area').style.display = 'block';
        document.getElementById('calc-area').style.display = 'none';
      }
    });

    window.login = function() {
      const email = document.getElementById('email').value;
      const pass = document.getElementById('password').value;
      signInWithEmailAndPassword(auth, email, pass)
        .catch(err => alert(err.message));
    }

    window.register = function() {
      const email = document.getElementById('email').value;
      const pass = document.getElementById('password').value;
      createUserWithEmailAndPassword(auth, email, pass)
        .catch(err => alert(err.message));
    }

    window.logout = function() {
      signOut(auth);
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; margin: 0; background: #f4f6fa; }
    header { background: #dc3545; color: white; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; }
    header h1 { margin: 0; }
    main { max-width: 960px; margin: 2rem auto; padding: 1rem; background: white; border-radius: 1rem; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    input, button { padding: 0.8rem; margin-top: 0.5rem; border-radius: 0.5rem; border: 1px solid #ccc; width: 100%; font-size: 1rem; }
    button { background: #dc3545; color: white; cursor: pointer; font-weight: bold; }
    #plot { margin-top: 2rem; height: 400px; }
    #chatbot { position: fixed; bottom: 20px; right: 20px; width: 320px; background: white; border: 1px solid #ccc; border-radius: 0.5rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: none; flex-direction: column; }
    #chatbot-header { background: #dc3545; color: white; padding: 0.5rem; border-radius: 0.5rem 0.5rem 0 0; font-weight: bold; }
    #chatbot-body { height: 200px; overflow-y: auto; padding: 0.5rem; font-size: 0.9rem; }
    #chatbot-input { display: flex; border-top: 1px solid #eee; }
    #chatbot-input input { flex: 1; border: none; padding: 0.5rem; }
    #chatbot-input button { background: #dc3545; color: white; border: none; padding: 0.5rem 1rem; }
    #login-area { margin-bottom: 2rem; }
  </style>
</head>
<body>
  <header>
    <h1>MathMajo</h1>
    <div>
      <button onclick="logout()">Cerrar sesión</button>
    </div>
  </header>

  <main>
    <div id="login-area">
      <h2>Iniciar sesión / Registrarse</h2>
      <input type="email" id="email" placeholder="Correo">
      <input type="password" id="password" placeholder="Contraseña">
      <button onclick="login()">Iniciar sesión</button>
      <button onclick="register()">Registrarse</button>
    </div>

    <div id="calc-area" style="display:none;">
      <h2>Calculadora de funciones</h2>
      <input type="text" id="funcion" placeholder="Ingresa una función (ej: x^2 - 4)">
      <button onclick="calcular()">Calcular</button>
      <div id="output"></div>
      <div id="plot"></div>
    </div>
  </main>

  <button onclick="toggleChatbot()" style="position:fixed;bottom:20px;right:20px;background:#dc3545;color:white;border:none;padding:1rem;border-radius:50%;font-size:1.5rem;">?</button>
  <div id="chatbot">
    <div id="chatbot-header">🤖 MajoBot</div>
    <div id="chatbot-body"><p><strong>MajoBot:</strong> Hola, ¿en qué te ayudo hoy?</p></div>
    <div id="chatbot-input">
      <input type="text" id="chat-input" placeholder="Tu pregunta...">
      <button onclick="enviarPregunta()">Enviar</button>
    </div>
  </div>

  <script>
    function calcular() {
      const exprText = document.getElementById('funcion').value;
      const expr = math.parse(exprText);
      const f = expr.compile();
      let x_vals = [], y_vals = [], minY = Infinity, maxY = -Infinity;
      for (let x = -10; x <= 10; x += 0.1) {
        try {
          let y = f.evaluate({x});
          x_vals.push(x); y_vals.push(y);
          if (y < minY) minY = y;
          if (y > maxY) maxY = y;
        } catch {}
      }
      Plotly.newPlot('plot', [{x: x_vals, y: y_vals, mode: 'lines', line: {color: '#0d6efd'}}]);
      document.getElementById('output').innerHTML =
        `<p><strong>Dominio aprox:</strong> [-10, 10]</p><p><strong>Rango aprox:</strong> [${minY.toFixed(2)}, ${maxY.toFixed(2)}]</p>`;
    }

    function toggleChatbot() {
      const bot = document.getElementById('chatbot');
      bot.style.display = bot.style.display === 'none' ? 'flex' : 'none';
    }

    async function enviarPregunta() {
      const input = document.getElementById('chat-input');
      const pregunta = input.value;
      const body = document.getElementById('chatbot-body');
      body.innerHTML += `<p><strong>Tú:</strong> ${pregunta}</p>`;
      input.value = '';
      const respuesta = await obtenerRespuestaIA(pregunta);
      body.innerHTML += `<p><strong>MajoBot:</strong> ${respuesta}</p>`;
      body.scrollTop = body.scrollHeight;
    }

    async function obtenerRespuestaIA(pregunta) {
      return new Promise(resolve => {
        setTimeout(() => {
          if (pregunta.includes('dominio')) resolve('El dominio es el conjunto de valores de entrada (x).');
          else if (pregunta.includes('rango')) resolve('El rango es el conjunto de salidas posibles de f(x).');
          else resolve('Lo siento, aún estoy aprendiendo sobre eso.');
        }, 1000);
      });
    }
  </script>
</body>
</html>
